# Copy this file to .github/workflows/sdlc-agent.yml in your repository
# 
# Required secrets (add in Settings > Secrets > Actions):
#   - GH_TOKEN: GitHub Personal Access Token with repo scope
#   - LLM_API_TOKEN: Your LLM API key (OpenAI, OpenRouter, etc.)
#
# Optional variables (add in Settings > Variables > Actions):
#   - LLM_API_URL: API endpoint URL (default: https://openrouter.ai/api/v1)
#   - LLM_MODEL: Model name (default: gpt-4o-mini)
#
# To use: Add the 'agent' label to an issue to trigger the SDLC agent

name: SDLC Agent

on:
  issues:
    types: [opened, labeled]

jobs:
  # Plan on new issue with 'agent' label, or when 'agent' label is added
  plan:
    name: Plan
    if: github.event_name == 'issues' && contains(github.event.issue.labels.*.name, 'agent')
    uses: Astro-Peter/coding-agent-megaschool/.github/workflows/reusable-planner.yml@main
    with:
      issue_number: ${{ github.event.issue.number }}
      plan_command: 'issue opened'
    secrets:
      GH_TOKEN: ${{ secrets.GH_TOKEN }}
      LLM_API_TOKEN: ${{ secrets.LLM_API_TOKEN }}

  # Code automatically after plan on issues with 'agent' label
  code_after_plan:
    name: Code (auto)
    needs: plan
    if: |
      github.event_name == 'issues' && 
      needs.plan.result == 'success' &&
      contains(github.event.issue.labels.*.name, 'agent')
    uses: Astro-Peter/coding-agent-megaschool/.github/workflows/reusable-coder.yml@main
    with:
      issue_number: ${{ github.event.issue.number }}
    secrets:
      GH_TOKEN: ${{ secrets.GH_TOKEN }}
      LLM_API_TOKEN: ${{ secrets.LLM_API_TOKEN }}

